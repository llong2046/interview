**Rag文档召回率**
```
定义：在检索阶段模型能够找到用户查询相关的所有文档的比例，是评估检索系统性能的重要指标
公式：召回率=检索到的相关文档数/所有相关文档的数量
文档召回率低，生成模型可能会缺乏足够的背景信息，影响答案的准确性和相关性
提高文档召回率措施：
    1.改进检索模型：使用更先进的检索模型
    2.扩展检索范围：增加知识库规模和多样性
    3.优化检索策略：多轮检索或结合多个模型检索结果

``` 
**Rag技术的难点**
```
1.数据处理:数据文档种类多，ppt和pdf里的图片信息提取麻烦
2.数据切片:不同的文档机构需要不同的切片方式
3.内部专有名词不好查询
4.新旧版本文档同时存在
5.复杂逻辑推理
6.金融行业公式计算
7.向量检索的局限性：查询语句太短词向量无法反应真实含义
8.长文本
9.多轮回答
``` 
**Rag存在的问题和避免方式**
```
分块策略及Top-k算法
世界知识丢失
多跳问题
信息丢失
``` 
**rag与微调**
```
考虑点：
1.访问大量外部数据，实时更新rag更适用
2.改变模型输出风格，如更像医学的专业人士，诗意的风格更适合微调
3.rag和微调可以单独也可以组合使用
4.微调在一定程度上可以减少幻觉，rag系统天生不容易产生幻觉
``` 
**Langchain的rag系统实现步骤**
```
加载文件、读取文本、文本切割、文本向量化、问句向量化、在文本向量中匹配的问句向量相似的topk个，将匹配的文本和问题一起添加到prompt中，由llm给出回答
``` 
**如何保证文档切片不会造成内容丢失**
```
基于规则的切分方法
1.固定长度：按预设字符数，优点：实现简单计算效率高 缺点：会破坏语义完整性
2.递归：先按大章节分割，超长部分按小单元递归切分 优点：实现稍微复杂
3.结构化：标题、章节、表格 优点：检索精确度高 缺点：依赖文档格式
语义切分
1.语义切分：按照文本句子段落，相邻段落的嵌入向量相似度，合并相似度高的段落 缺点：计算成本高
2.LLM辅助切分：大模型识别独立的语义片段 缺点：依赖模型，计算成本高
``` 
**Emmbeding模型的作用**
```
1.切片和使用向量数据库的目的是由于llm模型上下文窗口的限制（512-8192Token）
2.Emmbedding模型将切片后的文本转换为向量，在检索时匹配用户问题与知识库片段
``` 
**假设文档嵌入HyDE**
```
定义：HyDE是Rag中一种重要的预检索查询重写策略
核心思想：1.生成理论文档 2.关注答案的嵌入相似性 3.语义空间对齐
流程:1.使用LLM基于查询生成K个假设文档 2.将生成的假设文档输入编码器 3.计算K个向量的平均值 4.使用向量v从文档库中检索答案
作用：它通过引入LLM生成假设文档的中间步骤，提升检索质量，尤其是用户查询语义不够清晰，解决查询措辞不准确的问题
``` 
**Rag的评估指标**
```
上下文精确度：正确信息是否被排在较高的位置
上下文召回率：召回率其实就是捕捉相关性的能力
忠实度：衡量生成答案中的幻觉情况
答案相关性：答案对问题的直接性
``` 
**lamaindex索引**
```
索引的概念：
index是一种数据结构，用于快速检索用户查询的相关上下文，它是RAG的核心基础
Node对应的是文档中的一段文本
5种索引类型：循序索引、向量索引、树索引、关键字表索引、知识图谱索引
``` 
**向量数据库**
```
概念：是一种将数据存储为高位向量的数据库，高维向量是特征或属性的数学表示
特点：
    1.支持相似性检索、精确或近似的最近邻搜索，找到与查询向量最近的K个向量
    2.向量压缩技术减少存储空间提高查询性能
    3.可以使用机器学习模型将数据源转化为向量嵌入，如词、句子、图像嵌入等
``` 
**有哪些向量数据库**
```
1.FAISS 2.Milvus 3.Pinecone 4.Weaviate 5.Qdrant 6.Elasticsearch 
``` 
**向量数据库的索引优化策略**
```
常见索引：
优化策略：
``` 
**1**
```

``` 